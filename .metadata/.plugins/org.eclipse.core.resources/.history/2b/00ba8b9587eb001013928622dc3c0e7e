
#include "SPI.h"

void spi1_config(void)
{
	//Configuring GPIOA (SPI1 connected to GPIOA)


	//AHB1ENR is clock bus for GPIOA
	RCC->AHB1ENR |= (RCC_AHB1ENR_GPIOAEN);
	(void)RCC->AHB1ENR;

	//SPI1 is connected to PA4,PA5,PA6,PA7

	//configuration of PA4,PA5,PA6 pins (MOSI, MISO, SCK)
	GPIOA->MODER &= ~((3U << 8) | (3U << 10) | (3U << 12));
	GPIOA->MODER |=  ((2U << 8) | (2U << 10) | (2U << 12));  //configuring as Alternative Functin Mode

	//configuration of AFL register for PA4,PA5,PA6
	GPIOA->AFR[0] &=  ~((15 << 16) | (15 << 20) | (15 << 24));
	GPIOA->AFR[0] |=   ((5 << 16) | (5 << 20) | (5 << 24));

	//configurtaion of PA7
	GPIOA->MODER &= ~(3 << 14);
	GPIOA->MODER |=  (1 << 14);                   //configuring PA7 as output (for clock)

	/************************************************************/

	//configuring SPI1

	SPI1->CR1 &= ~(SPI_CR1_SPE);

	SPI1->CR1 |= (1U << 3);

	SPI1->CR1 |= (SPI_CR1_CPOL);
	SPI1->CR1 |= (SPI_CR1_CPHA);

	SPI1->CR1 &= ~(SPI_CR1_LSBFIRST);     //send MSB first

	SPI1->CR1 |= (SPI_CR1_SSM);
	SPI1->CR1 |= (SPI_CR1_SSI);

}

void spi2_config(void)
{

}
